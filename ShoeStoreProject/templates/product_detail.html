{% extends "base.html" %}

{% block title %}{{ product.name }} - ShoeStore{% endblock %}

{% block content %}
<div class="d-flex flex-wrap gap-3">

    <div class="product-detail-image">
        <img src="{{ product.image_url }}"
             alt="{{ product.name }}"
             style="width: 100%; height: 100%; object-fit: cover; border-radius: 10px;"
             onerror="this.onerror=null; this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAwIiBoZWlnaHQ9IjMwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjNjY3ZWVhIi8+PHRleHQgeD0iNTAlIiB5PSI1MCUiIGZvbnQtc2l6ZT0iMjQiIGZpbGw9IndoaXRlIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBkeT0iLjNlbSI+8J+NnyA8L3RleHQ+PHRleHQgeD0iNTAlIiB5PSI2NSUiIGZvbnQtc2l6ZT0iMTYiIGZpbGw9IndoaXRlIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIj57eyBwcm9kdWN0Lm5hbWUgfX08L3RleHQ+PC9zdmc+'">
    </div>


    <div style="flex: 1; min-width: 300px;">
        <div class="card">
            <div class="d-flex justify-between align-center">
                <span class="product-category" style="background: #667eea; color: white; padding: 0.3rem 0.8rem; border-radius: 15px; font-size: 0.9rem;">
                    {{ catalog_service.get_category_name(product.category) }}
                </span>
                <span style="color: #666; font-size: 1rem;">
                    {{ catalog_service.get_gender_name(product.gender) }}
                </span>
            </div>

            <h1 class="mt-2">{{ product.name }}</h1>
            <p class="product-description">{{ product.description }}</p>

            <div class="product-details">
                <div class="product-price" style="font-size: 1.5rem;">{{ product.price }} лв.</div>
                <div class="product-stock {% if product.stock < 5 %}low{% endif %} {% if product.stock == 0 %}out{% endif %}">
                    {% if product.stock > 0 %}
                        Налични: {{ product.stock }}
                    {% else %}
                        Не е наличен
                    {% endif %}
                </div>
            </div>

            <div class="mt-3">
                <strong>Цвят:</strong> {{ product.color }}
            </div>

            {% if product.stock > 0 %}
            <form method="POST" action="{{ url_for('cart.add_to_cart', product_id=product.id) }}">

                <div class="form-group mt-3">
                    <label class="form-label"><strong>Размер:</strong></label>
                    <div class="size-options">
                        {% for size in product.sizes %}
                            <label class="size-option {% if loop.first %}selected{% endif %}">
                                <input type="radio" name="size" value="{{ size }}" required
                                       {% if loop.first %}checked{% endif %}>
                                {{ size }}
                            </label>
                        {% endfor %}
                    </div>
                </div>


                <div class="form-group">
                    <label class="form-label"><strong>Количество:</strong></label>
                    <div class="quantity-selector">
                        <button type="button" class="quantity-btn" onclick="decreaseQuantity()">-</button>
                        <input type="number" name="quantity" value="1" min="1" max="{{ product.stock }}"
                               class="quantity-input" id="quantityInput">
                        <button type="button" class="quantity-btn" onclick="increaseQuantity()">+</button>
                    </div>
                </div>

                <button type="submit" class="btn w-100 mt-3">
                    Добави в кошницата
                </button>
            </form>
            {% else %}
            <div class="mt-3">
                <button class="btn btn-secondary w-100" disabled>Продуктът не е наличен</button>
            </div>
            {% endif %}

            <div class="mt-3">
                <a href="{{ url_for('catalog.catalog') }}" class="btn btn-secondary w-100">
                    ← Назад към каталога
                </a>
            </div>
        </div>
    </div>
</div>

<script>
    function increaseQuantity() {
        const input = document.getElementById('quantityInput');
        const max = parseInt(input.max);
        if (parseInt(input.value) < max) {
            input.value = parseInt(input.value) + 1;
        }
    }

    function decreaseQuantity() {
        const input = document.getElementById('quantityInput');
        if (parseInt(input.value) > 1) {
            input.value = parseInt(input.value) - 1;
        }
    }


    document.addEventListener('DOMContentLoaded', function() {
        document.querySelectorAll('.size-option').forEach(option => {
            option.addEventListener('click', function() {
                document.querySelectorAll('.size-option').forEach(opt => {
                    opt.classList.remove('selected');
                });
                this.classList.add('selected');
                this.querySelector('input').checked = true;
            });


            const firstInput = document.querySelector('.size-option input[type="radio"]:checked');
            if (firstInput) {
                firstInput.parentElement.classList.add('selected');
            }
        });
    });
</script>
{% endblock %}