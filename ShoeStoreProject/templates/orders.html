{% extends "base.html" %}

{% block title %}Моите поръчки - ShoeStore{% endblock %}

{% block content %}
<h1>Моите поръчки</h1>

{% if orders %}
    {% for order in orders %}
    <div class="card">
        <div class="d-flex justify-between align-center flex-wrap">
            <div>
                <h3>Поръчка #{{ order.id }}</h3>
                <p class="mt-1"><strong>Дата:</strong> {{ order.created_at.strftime('%d.%m.%Y %H:%M') }}</p>
                <p><strong>Статус:</strong> 
                    <span class="order-status 
                        {% if order.status == 'Обработва се' %}status-processing
                        {% elif order.status == 'Потвърдена' %}status-confirmed
                        {% elif order.status == 'Изпратена' %}status-shipped
                        {% elif order.status == 'Доставена' %}status-delivered
                        {% elif order.status == 'Отказана' %}status-cancelled
                        {% endif %}">
                        {{ order.status }}
                    </span>
                </p>
                <p><strong>Адрес:</strong> {{ order.address }}</p>
                <p><strong>Плащане:</strong> {{ order.payment_method }}</p>
            </div>
            
            <div class="text-right">
                <div class="product-price">{{ order.total }} лв.</div>
            </div>
        </div>
        
        <div class="mt-3">
            <h4>Продукти:</h4>
            <div class="table">
                <table style="width: 100%;">
                    <thead>
                        <tr>
                            <th>Продукт</th>
                            <th>Размер</th>
                            <th>Количество</th>
                            <th>Цена</th>
                            <th>Общо</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for item in order.items %}
                        <tr>
                            <td>
                                {% set product = catalog_service.get_product_by_id(item.product_id) %}
                                {% if product %}
                                    {{ product.name }}
                                {% else %}
                                    Продукт №{{ item.product_id }}
                                {% endif %}
                            </td>
                            <td>{{ item.size }}</td>
                            <td>{{ item.quantity }}</td>
                            <td>{{ item.price }} лв.</td>
                            <td>{{ item.subtotal }} лв.</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    {% endfor %}
{% else %}
    <div class="card text-center">
        <h3>Все още нямате поръчки</h3>
        <p>Разгледайте нашите продукти и направете първата си поръчка!</p>
        <a href="{{ url_for('catalog.catalog') }}" class="btn mt-2">Разгледай продукти</a>
    </div>
{% endif %}
{% endblock %}