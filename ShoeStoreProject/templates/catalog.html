{% extends "base.html" %}

{% block title %}Каталог - ShoeStore{% endblock %}

{% block content %}
<h1>Каталог с обувки</h1>

<div class="card">
    <form method="GET" class="d-flex justify-between align-center flex-wrap gap-2">
        <div style="flex: 1; min-width: 200px;">
            <input type="text"
                   name="search"
                   class="form-control"
                   placeholder="Търсете по име, цвят или описание..."
                   value="{{ search_term }}">
        </div>

        <div class="d-flex gap-2 flex-wrap">
            <select name="category" class="form-select">
                <option value="">Всички категории</option>
                <option value="sports" {% if category == 'sports' %}selected{% endif %}>Спортни</option>
                <option value="formal" {% if category == 'formal' %}selected{% endif %}>Официални</option>
                <option value="boots" {% if category == 'boots' %}selected{% endif %}>Ботуши</option>
                <option value="sandals" {% if category == 'sandals' %}selected{% endif %}>Летни</option>
            </select>

            <select name="gender" class="form-select">
                <option value="">Всички</option>
                <option value="men" {% if gender == 'men' %}selected{% endif %}>Мъжки</option>
                <option value="women" {% if gender == 'women' %}selected{% endif %}>Дамски</option>
                <option value="unisex" {% if gender == 'unisex' %}selected{% endif %}>Унисекс</option>
            </select>

            <select name="sort_by" class="form-select">
                <option value="name" {% if sort_by == 'name' %}selected{% endif %}>По име</option>
                <option value="price" {% if sort_by == 'price' %}selected{% endif %}>По цена</option>
                <option value="stock" {% if sort_by == 'stock' %}selected{% endif %}>По наличност</option>
            </select>

            <select name="sort_order" class="form-select">
                <option value="asc" {% if sort_order == 'asc' %}selected{% endif %}>Възходящо</option>
                <option value="desc" {% if sort_order == 'desc' %}selected{% endif %}>Низходящо</option>
            </select>

            <button type="submit" class="btn">Търси</button>

            {% if search_term or category or gender %}
                <a href="{{ url_for('catalog.catalog') }}" class="btn btn-danger">Изчисти</a>
            {% endif %}
        </div>
    </form>
</div>

<div class="card mt-3">
    <h3>Бързи категории</h3>
    <div class="d-flex gap-2 flex-wrap mt-2">
        <a href="{{ url_for('catalog.category_view', category_name='sports') }}" class="btn">Спортни обувки</a>
        <a href="{{ url_for('catalog.category_view', category_name='formal') }}" class="btn">Официални обувки</a>
        <a href="{{ url_for('catalog.category_view', category_name='boots') }}" class="btn">Ботуши</a>
        <a href="{{ url_for('catalog.category_view', category_name='sandals') }}" class="btn">Летни обувки</a>
    </div>
</div>

{% if products %}
    <div class="product-grid">
        {% for product in products %}
            <div class="product-card">
                <div class="product-image">
                    <img src="{{ product.image_url }}"
                         alt="{{ product.name }}"
                         loading="lazy"
                         onerror="this.onerror=null; this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAwIiBoZWlnaHQ9IjMwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjNjY3ZWVhIi8+PHRleHQgeD0iNTAlIiB5PSI1MCUiIGZvbnQtc2l6ZT0iMTgiIGZpbGw9IndoaXRlIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBkeT0iLjNlbSI+8J+NnyA8L3RleHQ+PHRleHQgeD0iNTAlIiB5PSI2NSUiIGZvbnQtc2l6ZT0iMTQiIGZpbGw9IndoaXRlIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIj57eyBwcm9kdWN0Lm5hbWUgfX08L3RleHQ+PC9zdmc+'">
                </div>
                <div class="product-info">
                    <div class="d-flex justify-between align-center">
                        <span class="product-category" style="background: #667eea; color: white; padding: 0.2rem 0.5rem; border-radius: 12px; font-size: 0.8rem;">
                            {{ catalog_service.get_category_name(product.category) }}
                        </span>
                        <span style="color: #666; font-size: 0.9rem;">
                            {{ catalog_service.get_gender_name(product.gender) }}
                        </span>
                    </div>

                    <h3 class="product-name">{{ product.name }}</h3>
                    <p class="product-description">{{ product.description }}</p>

                    <div class="product-details">
                        <div class="product-price">{{ product.price }} лв.</div>
                        <div class="product-stock {% if product.stock < 5 %}low{% endif %} {% if product.stock == 0 %}out{% endif %}">
                            {% if product.stock > 0 %}
                                Налични: {{ product.stock }}
                            {% else %}
                                Не е наличен
                            {% endif %}
                        </div>
                    </div>

                    <div class="mt-2">
                        <strong>Цвят:</strong> {{ product.color }}<br>
                        <strong>Размери:</strong> {{ product.sizes|join(', ') }}
                    </div>

                    <a href="{{ url_for('catalog.product_detail', product_id=product.id) }}"
                       class="btn w-100 mt-2 text-center">
                        Виж детайли
                    </a>
                </div>
            </div>
        {% endfor %}
    </div>
{% else %}
    <div class="card text-center mt-4">
        <h3>Няма намерени продукти</h3>
        <p>Опитайте с други критерии за търсене.</p>
        <a href="{{ url_for('catalog.catalog') }}" class="btn mt-2">Изчисти филтри</a>
    </div>
{% endif %}
{% endblock %}